<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Decay functions • accessibility</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Decay functions">
<meta name="robots" content="noindex">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">accessibility</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.4.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/accessibility.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/decay_functions.html">Decay functions</a></li>
    <li><a class="dropdown-item" href="../articles/inequality_and_poverty.html">Calculating accessibility inequality and poverty</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ipeaGIT/accessibility/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Decay functions</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ipeaGIT/accessibility/blob/main/vignettes/decay_functions.Rmd" class="external-link"><code>vignettes/decay_functions.Rmd</code></a></small>
      <div class="d-none name"><code>decay_functions.Rmd</code></div>
    </div>

    
    
<p>Some functions of the <strong>accessibility</strong> package, such as
<code><a href="../reference/floating_catchment_area.html">floating_catchment_area()</a></code> and <code><a href="../reference/gravity.html">gravity()</a></code>, use
decay functions to continuously discount the weight of opportunities as
travel costs become larger. For convenience, the package ships with some
of the most frequently used functions in the accessibility literature,
which are discussed below. Additionally, users can pass custom functions
to convert travel costs into weights to be applied to the opportunities,
which is discussed further down in this the vignette.</p>
<div class="section level2">
<h2 id="currently-available-decay-functions">Currently available decay functions<a class="anchor" aria-label="anchor" href="#currently-available-decay-functions"></a>
</h2>
<div class="section level3">
<h3 id="binary">Binary<a class="anchor" aria-label="anchor" href="#binary"></a>
</h3>
<p>Also known as the step decay function, it’s most commonly used in
cumulative opportunities measures.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">{</mo><mtable><mtr><mtd columnalign="left" style="text-align: left"><mn>1</mn></mtd><mtd columnalign="left" style="text-align: left"><mspace width="1.0em"></mspace><mrow><mtext mathvariant="normal">for </mtext><mspace width="0.333em"></mspace></mrow><msub><mi>t</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>≤</mo><mi>T</mi></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><mn>0</mn></mtd><mtd columnalign="left" style="text-align: left"><mspace width="1.0em"></mspace><mrow><mtext mathvariant="normal">for </mtext><mspace width="0.333em"></mspace></mrow><msub><mi>t</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>&gt;</mo><mi>T</mi></mtd></mtr></mtable></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
  f(t_{ij})= \left\{
      \begin{array}{ll}
          1 &amp; \quad \text{for }t_{ij} \leq T \\
          0 &amp; \quad \text{for }t_{ij} &gt; T
      \end{array}
    \right.\\
\end{aligned}
</annotation></semantics></math></p>
<p>Where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>t</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">t_{ij}</annotation></semantics></math>
is the travel cost between origin <em>i</em> and destination <em>j</em>,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation></semantics></math>
is the travel cost cutoff.</p>
</div>
<div class="section level3">
<h3 id="linear">Linear<a class="anchor" aria-label="anchor" href="#linear"></a>
</h3>
<p>Weights decay linearly until the travel cost cutoff is reached. From
this point onward weights assume the value of 0.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">{</mo><mtable><mtr><mtd columnalign="left" style="text-align: left"><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><msub><mi>t</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mi>/</mi><mi>T</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mspace width="1.0em"></mspace><mrow><mtext mathvariant="normal">for </mtext><mspace width="0.333em"></mspace></mrow><msub><mi>t</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>≤</mo><mi>T</mi></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><mn>0</mn></mtd><mtd columnalign="left" style="text-align: left"><mspace width="1.0em"></mspace><mrow><mtext mathvariant="normal">for </mtext><mspace width="0.333em"></mspace></mrow><msub><mi>t</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>&gt;</mo><mi>T</mi></mtd></mtr></mtable></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
  f(t_{ij})= \left\{
      \begin{array}{ll}
          (1 - t_{ij}/ T) &amp; \quad \text{for }t_{ij} \leq T \\
          0 &amp; \quad \text{for }t_{ij} &gt; T
      \end{array}
    \right.\\
\end{aligned}
</annotation></semantics></math></p>
<p>Where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>t</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">t_{ij}</annotation></semantics></math>
is the travel cost between origin <em>i</em> and destination <em>j</em>,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>T</mi><annotation encoding="application/x-tex">T</annotation></semantics></math>
is the travel cost cutoff.</p>
</div>
<div class="section level3">
<h3 id="negative-exponential">Negative exponential<a class="anchor" aria-label="anchor" href="#negative-exponential"></a>
</h3>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msup><mi>e</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo>−</mo><mi>β</mi><msub><mi>t</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></msup></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
  f(t_{ij})= e^{(-\beta t_{ij})}
\end{aligned}
</annotation></semantics></math></p>
<p>Where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>t</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">t_{ij}</annotation></semantics></math>
is the travel cost between origin <em>i</em> and destination <em>j</em>,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>
is the parameter that tells the speed of decay.</p>
</div>
<div class="section level3">
<h3 id="inverse-power">Inverse power<a class="anchor" aria-label="anchor" href="#inverse-power"></a>
</h3>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">{</mo><mtable><mtr><mtd columnalign="left" style="text-align: left"><mn>1</mn></mtd><mtd columnalign="left" style="text-align: left"><mspace width="1.0em"></mspace><mrow><mtext mathvariant="normal">for </mtext><mspace width="0.333em"></mspace></mrow><msub><mi>t</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>≤</mo><mn>1</mn></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><msubsup><mi>t</mi><mrow><mi>i</mi><mi>j</mi></mrow><mrow><mo>−</mo><mi>β</mi></mrow></msubsup></mtd><mtd columnalign="left" style="text-align: left"><mspace width="1.0em"></mspace><mrow><mtext mathvariant="normal">for </mtext><mspace width="0.333em"></mspace></mrow><msub><mi>t</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>&gt;</mo><mn>1</mn></mtd></mtr></mtable></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
  f(t_{ij})= \left\{
      \begin{array}{ll}
          1 &amp; \quad \text{for } t_{ij}\leq 1 \\
          t_{ij}^{-\beta} &amp; \quad \text{for }t_{ij} &gt; 1
      \end{array}
    \right.\\
\end{aligned}
</annotation></semantics></math></p>
<p>Where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>t</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">t_{ij}</annotation></semantics></math>
is the travel cost between origin <em>i</em> and destination <em>j</em>,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>
is the parameter that tells the speed of decay.</p>
</div>
<div class="section level3">
<h3 id="stepped">Stepped<a class="anchor" aria-label="anchor" href="#stepped"></a>
</h3>
<p>Similar to the binary function, but can take an arbitrary number of
steps. The current implementation assumes that values changes at each
step, instead of right after it.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">{</mo><mtable><mtr><mtd columnalign="left" style="text-align: left"><mn>1</mn></mtd><mtd columnalign="left" style="text-align: left"><mspace width="1.0em"></mspace><mrow><mtext mathvariant="normal">for </mtext><mspace width="0.333em"></mspace></mrow><msub><mi>t</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>&lt;</mo><msub><mi>S</mi><mn>1</mn></msub></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><msub><mi>v</mi><mn>1</mn></msub></mtd><mtd columnalign="left" style="text-align: left"><mspace width="1.0em"></mspace><mrow><mtext mathvariant="normal">for </mtext><mspace width="0.333em"></mspace></mrow><msub><mi>t</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>&lt;</mo><msub><mi>S</mi><mn>2</mn></msub></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><msub><mi>v</mi><mn>2</mn></msub></mtd><mtd columnalign="left" style="text-align: left"><mspace width="1.0em"></mspace><mrow><mtext mathvariant="normal">for </mtext><mspace width="0.333em"></mspace></mrow><msub><mi>t</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>&lt;</mo><msub><mi>S</mi><mn>3</mn></msub></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><mi>.</mi><mi>.</mi><mi>.</mi></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><msub><mi>v</mi><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msub></mtd><mtd columnalign="left" style="text-align: left"><mspace width="1.0em"></mspace><mrow><mtext mathvariant="normal">for </mtext><mspace width="0.333em"></mspace></mrow><msub><mi>t</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>&lt;</mo><msub><mi>S</mi><mi>n</mi></msub></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><msub><mi>v</mi><mi>n</mi></msub></mtd><mtd columnalign="left" style="text-align: left"><mspace width="1.0em"></mspace><mtext mathvariant="normal">otherwise</mtext></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"></mtd></mtr></mtable></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
  f(t_{ij})= \left\{
      \begin{array}{ll}
          1 &amp; \quad \text{for } t_{ij} \lt S_{1} \\
          v_{1} &amp; \quad \text{for } t_{ij} \lt S_{2} \\
          v_{2} &amp; \quad \text{for } t_{ij} \lt S_{3} \\
          ... \\
          v_{n-1} &amp; \quad \text{for } t_{ij} \lt S_{n} \\
          v_{n} &amp; \quad \text{otherwise} \\
      \end{array}
    \right.\\
\end{aligned}
</annotation></semantics></math></p>
<p>Where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>t</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">t_{ij}</annotation></semantics></math>
is the travel cost between origin <em>i</em> and destination <em>j</em>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
is the total number of steps,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>S</mi><mi>k</mi></msub><annotation encoding="application/x-tex">S_{k}</annotation></semantics></math>
is the travel cost cutoff that delimits the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>k</mi><mrow><mi>t</mi><mi>h</mi></mrow></msup><annotation encoding="application/x-tex">k^{th}</annotation></semantics></math>
step, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>v</mi><mi>k</mi></msub><annotation encoding="application/x-tex">v_{k}</annotation></semantics></math>
is the value that the decay function assumes at the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>k</mi><mrow><mi>t</mi><mi>h</mi></mrow></msup><annotation encoding="application/x-tex">k^{th}</annotation></semantics></math>
step.</p>
</div>
<div class="section level3">
<h3 id="logistic">Logistic<a class="anchor" aria-label="anchor" href="#logistic"></a>
</h3>
<p>Weights decay sigmoidally, according to a reversed cumulative
logistic curve. Currently, the function implements a logistic
distribution parameterized with the cutoff that sets its inflection
point and the standard deviation that sets its steepness, according to
the logistic decay curve proposed by <span class="citation">Bauer and
Groneberg (2016)</span>. Standard deviations values near 0 result in
weighting curves that approximate binary decay, while higher values tend
to linearize the curve.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mi>f</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mrow><mn>1</mn><mo>+</mo><msup><mi>e</mi><mfrac><mrow><mo>−</mo><mi>I</mi><mi>P</mi><mo>×</mo><mi>π</mi></mrow><mrow><mi>S</mi><mi>D</mi><mo>×</mo><msqrt><mn>3</mn></msqrt></mrow></mfrac></msup></mrow><mrow><mn>1</mn><mo>+</mo><msup><mi>e</mi><mfrac><mrow><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>−</mo><mi>I</mi><mi>P</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>×</mo><mi>π</mi></mrow><mrow><mi>S</mi><mi>D</mi><mo>×</mo><msqrt><mn>3</mn></msqrt></mrow></mfrac></msup></mrow></mfrac></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
  f(t_{ij}) = \frac{
    1 + e^\frac{-IP \times \pi}{SD \times \sqrt{3}}}{
    1 + e^\frac{(t_{ij} - IP) \times \pi}{SD \times \sqrt{3}}}
\end{aligned}
</annotation></semantics></math></p>
<p>Where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>t</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">t_{ij}</annotation></semantics></math>
is the travel cost between origin <em>i</em> and destination <em>j</em>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mi>P</mi></mrow><annotation encoding="application/x-tex">IP</annotation></semantics></math>
is the distribution inflection point, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi>D</mi></mrow><annotation encoding="application/x-tex">SD</annotation></semantics></math>
is the distribution standard deviation.</p>
<div class="section level4">
<h4 id="quick-demonstration">Quick demonstration<a class="anchor" aria-label="anchor" href="#quick-demonstration"></a>
</h4>
<p>All decay functions (<code>decay_*()</code>) take decay parameters as
input and return a function as output. This output function, in turn,
takes a vector of numeric values as input, the travel costs, and returns
a list of numeric vectors as output. Since the decay function can take
multiple decay parameters as input, each element of the output list
refers to the opportunities weights calculated with one of these decay
parameters.</p>
<p>Let’s check this behavior with an example. With the code snippet
below, we calculate the opportunities weights for the same travel costs,
but using different negative exponential decay values (0.2 and 0.3):</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ipeaGIT/accessibility" class="external-link">accessibility</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">output_fn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/decay_exponential.html">decay_exponential</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">output_fn</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; $`0.2`</span></span>
<span><span class="co">#&gt; [1] 0.13533528 0.04978707 0.01831564</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`0.3`</span></span>
<span><span class="co">#&gt; [1] 0.049787068 0.011108997 0.002478752</span></span></code></pre></div>
<p><code><a href="../reference/decay_stepped.html">decay_stepped()</a></code>, as the only decay function that takes
more than one argument (both <code>steps</code> and
<code>weights</code>) names the output elements after the combination of
steps and weights:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stepped_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/decay_stepped.html">decay_stepped</a></span><span class="op">(</span></span>
<span>  steps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span>, <span class="fl">40</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.67</span>, <span class="fl">0.33</span>, <span class="fl">0</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.75</span>, <span class="fl">0.5</span>, <span class="fl">0.25</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">stepped_output</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">25</span>, <span class="fl">35</span>, <span class="fl">45</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; $`s(10,20,30);w(0.67,0.33,0)`</span></span>
<span><span class="co">#&gt; [1] 0.67 0.33 0.00 0.00</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`s(10,20,30,40);w(0.75,0.5,0.25,0)`</span></span>
<span><span class="co">#&gt; [1] 0.75 0.50 0.25 0.00</span></span></code></pre></div>
<p>With the code below, we demonstrate each decay function with travel
costs ranging from 1 to 100:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">binary</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/decay_binary.html">decay_binary</a></span><span class="op">(</span>cutoff <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span><span class="va">linear</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/decay_linear.html">decay_linear</a></span><span class="op">(</span>cutoff <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span><span class="va">negative_exp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/decay_exponential.html">decay_exponential</a></span><span class="op">(</span>decay_value <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="va">inverse_power</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/decay_power.html">decay_power</a></span><span class="op">(</span>decay_value <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="va">stepped</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/decay_stepped.html">decay_stepped</a></span><span class="op">(</span>steps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">60</span>, <span class="fl">90</span><span class="op">)</span>, weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.67</span>, <span class="fl">0.33</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">logistic</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/decay_logistic.html">decay_logistic</a></span><span class="op">(</span>cutoff <span class="op">=</span> <span class="fl">50</span>, sd <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="va">travel_costs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">100</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span></span>
<span>  minutes <span class="op">=</span> <span class="va">travel_costs</span>,</span>
<span>  binary <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu">binary</span><span class="op">(</span><span class="va">travel_costs</span><span class="op">)</span><span class="op">[[</span><span class="st">"50"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  linear <span class="op">=</span> <span class="fu">linear</span><span class="op">(</span><span class="va">travel_costs</span><span class="op">)</span><span class="op">[[</span><span class="st">"50"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  negative_exp <span class="op">=</span> <span class="fu">negative_exp</span><span class="op">(</span><span class="va">travel_costs</span><span class="op">)</span><span class="op">[[</span><span class="st">"0.2"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  inverse_power <span class="op">=</span> <span class="fu">inverse_power</span><span class="op">(</span><span class="va">travel_costs</span><span class="op">)</span><span class="op">[[</span><span class="st">"0.2"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  stepped <span class="op">=</span> <span class="fu">stepped</span><span class="op">(</span><span class="va">travel_costs</span><span class="op">)</span><span class="op">[[</span><span class="st">"s(30,60,90);w(0.67,0.33,0)"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  logistic <span class="op">=</span> <span class="fu">logistic</span><span class="op">(</span><span class="va">travel_costs</span><span class="op">)</span><span class="op">[[</span><span class="st">"c50;sd10"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># reshape data to long format</span></span>
<span><span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/melt.data.table.html" class="external-link">melt</a></span><span class="op">(</span></span>
<span>  <span class="va">weights</span>,</span>
<span>  id.vars <span class="op">=</span> <span class="st">"minutes"</span>,</span>
<span>  variable.name <span class="op">=</span> <span class="st">"decay_function"</span>,</span>
<span>  value.name <span class="op">=</span> <span class="st">"weights"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">weights</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">minutes</span>, <span class="va">weights</span>, color <span class="op">=</span> <span class="va">decay_function</span><span class="op">)</span>,</span>
<span>    show.legend <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="va">.</span> <span class="op">~</span> <span class="va">decay_function</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="decay_functions_files/figure-html/unnamed-chunk-4-1.png" class="r-plt" alt="" width="80%"></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="using-a-custom-decay-function">Using a custom decay function<a class="anchor" aria-label="anchor" href="#using-a-custom-decay-function"></a>
</h2>
<p><strong>accessibility</strong> also allows you to use a custom decay
function, instead of one of the functions shipped with the package. A
valid decay function is one that takes a <code>numeric</code> vector of
travel costs as input and returns either:</p>
<ul>
<li>A <code>numeric</code> vector of weights, with the same length of
input, or;</li>
<li>A named <code>list</code> of <code>numeric</code> vectors to be used
as weights, each one with the same length of input.</li>
</ul>
<p>Let’s check the difference between each case with an example. Suppose
we want to use a very simple decay function that defines the weights as
the multiplicative inverse of travel cost -
i.e. <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mi>r</mi><mi>a</mi><mi>v</mi><mi>e</mi><mi>l</mi><mi>_</mi><mi>c</mi><mi>o</mi><mi>s</mi><msup><mi>t</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">travel\_cost^{-1}</annotation></semantics></math>.
We just have to take care of the case when travel cost is less than 1,
in which case the function would return values greater than 1 and which
we will replace with 1, but otherwise the implementation is pretty
simple:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_decay</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">travel_cost</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">weights</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="va">travel_cost</span></span>
<span>  <span class="va">weights</span><span class="op">[</span><span class="va">weights</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">weights</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Given a <code>numeric</code> vector of travel costs, the function
returns a <code>numeric</code> vector of weights:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">my_decay</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.0 1.0 1.0 0.5 0.2 0.1</span></span></code></pre></div>
<p>Using this function to calculate accessibility is as easy as any of
the built-in decay functions:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"accessibility"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">travel_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_dir</span>, <span class="st">"travel_matrix.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">land_use_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_dir</span>, <span class="st">"land_use_data.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">custom_gravity</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gravity.html">gravity</a></span><span class="op">(</span></span>
<span>  <span class="va">travel_matrix</span>,</span>
<span>  <span class="va">land_use_data</span>,</span>
<span>  opportunity <span class="op">=</span> <span class="st">"jobs"</span>,</span>
<span>  travel_cost <span class="op">=</span> <span class="st">"travel_time"</span>,</span>
<span>  decay_function <span class="op">=</span> <span class="va">my_decay</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">custom_gravity</span><span class="op">)</span></span>
<span><span class="co">#&gt;                 id     jobs</span></span>
<span><span class="co">#&gt;             &lt;char&gt;    &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: 89a88cdb57bffff 11210.42</span></span>
<span><span class="co">#&gt; 2: 89a88cdb597ffff 10775.77</span></span>
<span><span class="co">#&gt; 3: 89a88cdb5b3ffff 11480.25</span></span>
<span><span class="co">#&gt; 4: 89a88cdb5cfffff 12689.44</span></span>
<span><span class="co">#&gt; 5: 89a88cd909bffff 11361.66</span></span>
<span><span class="co">#&gt; 6: 89a88cd90b7ffff 12563.65</span></span></code></pre></div>
<p>Great! But now suppose we want to change this function a bit. Instead
of the simple multiplicative inverse of the travel cost, we want to
multiply this inverse by a given decay parameter. Now we face a
“problem”: our function would need to take two inputs (the travel cost,
as above, and the decay parameter to multiply the travel cost), but
<code><a href="../reference/gravity.html">gravity()</a></code> can only take functions that receive a single
input (the travel cost). In this case, we resort to the same strategy
used in the decay functions shipped with the package, we create a
function that takes a decay parameter as input and returns a function
that takes travel cost input as output:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_second_decay</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">decay_parameter</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">travel_cost</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">weights</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="va">decay_parameter</span> <span class="op">*</span> <span class="va">travel_cost</span><span class="op">)</span></span>
<span>    <span class="va">weights</span><span class="op">[</span><span class="va">weights</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">weights</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">output_fn</span> <span class="op">&lt;-</span> <span class="fu">my_second_decay</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu">output_fn</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.00 1.00 0.50 0.25 0.10 0.05</span></span>
<span></span>
<span><span class="co"># compare to the first custom decay function</span></span>
<span><span class="fu">my_decay</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.0 1.0 1.0 0.5 0.2 0.1</span></span></code></pre></div>
<p>Great, it works! In fact, we can achieve the exact same
<code><a href="../reference/gravity.html">gravity()</a></code> result shown above if we use
<code>my_second_decay(1)</code>, instead of <code>my_decay</code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">second_custom_gravity</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gravity.html">gravity</a></span><span class="op">(</span></span>
<span>  <span class="va">travel_matrix</span>,</span>
<span>  <span class="va">land_use_data</span>,</span>
<span>  opportunity <span class="op">=</span> <span class="st">"jobs"</span>,</span>
<span>  travel_cost <span class="op">=</span> <span class="st">"travel_time"</span>,</span>
<span>  decay_function <span class="op">=</span> <span class="fu">my_second_decay</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">second_custom_gravity</span><span class="op">)</span></span>
<span><span class="co">#&gt;                 id     jobs</span></span>
<span><span class="co">#&gt;             &lt;char&gt;    &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1: 89a88cdb57bffff 11210.42</span></span>
<span><span class="co">#&gt; 2: 89a88cdb597ffff 10775.77</span></span>
<span><span class="co">#&gt; 3: 89a88cdb5b3ffff 11480.25</span></span>
<span><span class="co">#&gt; 4: 89a88cdb5cfffff 12689.44</span></span>
<span><span class="co">#&gt; 5: 89a88cd909bffff 11361.66</span></span>
<span><span class="co">#&gt; 6: 89a88cd90b7ffff 12563.65</span></span></code></pre></div>
<p>A small difference is that in the first example we passed
<code>my_decay</code> (the function <em>object</em>) to the
<code>decay_function</code> parameter, whereas in the second we passed
the function <em>call</em> <code>my_second_decay(1)</code>. That’s
because <code>my_second_decay()</code> (and the built-in decay functions
as well) is actually a function “factory”: it’s a function that returns
a function.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/decay_power.html">decay_power</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; function (travel_cost) </span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     weights_list &lt;- lapply(decay_value, function(x) {</span></span>
<span><span class="co">#&gt;         weights &lt;- travel_cost^(-x)</span></span>
<span><span class="co">#&gt;         weights[weights &gt; 1] &lt;- 1</span></span>
<span><span class="co">#&gt;         weights</span></span>
<span><span class="co">#&gt;     })</span></span>
<span><span class="co">#&gt;     names(weights_list) &lt;- decay_value</span></span>
<span><span class="co">#&gt;     return(weights_list)</span></span>
<span><span class="co">#&gt; }</span></span>
<span><span class="co">#&gt; &lt;bytecode: 0x563420076550&gt;</span></span>
<span><span class="co">#&gt; &lt;environment: 0x563425094eb0&gt;</span></span></code></pre></div>
<p>What if we want our custom function to take many decay parameters as
inputs, just like the built-in decay functions? In this case, our output
function has to return a <code>list</code> of <code>numeric</code>
weights named after the decay parameters we have set:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_third_decay</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">decay_parameter</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">travel_cost</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">weighting_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>      <span class="va">decay_parameter</span>,</span>
<span>      <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">weights</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="va">x</span> <span class="op">*</span> <span class="va">travel_cost</span><span class="op">)</span></span>
<span>        <span class="va">weights</span><span class="op">[</span><span class="va">weights</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">weights</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">weighting_list</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">decay_parameter</span></span>
<span>    <span class="va">weighting_list</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">output_fn</span> <span class="op">&lt;-</span> <span class="fu">my_third_decay</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">output_fn</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; $`1`</span></span>
<span><span class="co">#&gt; [1] 1.0 1.0 1.0 0.5 0.2 0.1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`2`</span></span>
<span><span class="co">#&gt; [1] 1.00 1.00 0.50 0.25 0.10 0.05</span></span>
<span></span>
<span><span class="co"># compare to the first and second custom decay functions</span></span>
<span></span>
<span><span class="fu">my_decay</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.0 1.0 1.0 0.5 0.2 0.1</span></span>
<span></span>
<span><span class="fu">my_second_decay</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.00 1.00 0.50 0.25 0.10 0.05</span></span></code></pre></div>
<p>This new custom decay function is a bit more complex than the
previous two, yet much more powerful. We can use it in conjunction with
<code><a href="../reference/gravity.html">gravity()</a></code> (and the other accessibility functions that take
decay functions as input as well) to calculate the accessibility with
multiple decay parameters in a single call:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">third_custom_gravity</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gravity.html">gravity</a></span><span class="op">(</span></span>
<span>  <span class="va">travel_matrix</span>,</span>
<span>  <span class="va">land_use_data</span>,</span>
<span>  opportunity <span class="op">=</span> <span class="st">"jobs"</span>,</span>
<span>  travel_cost <span class="op">=</span> <span class="st">"travel_time"</span>,</span>
<span>  decay_function <span class="op">=</span> <span class="fu">my_third_decay</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">third_custom_gravity</span></span>
<span><span class="co">#&gt;                    id decay_function_arg      jobs</span></span>
<span><span class="co">#&gt;                &lt;char&gt;              &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1: 89a88cdb57bffff                  1 11210.421</span></span>
<span><span class="co">#&gt;    2: 89a88cdb597ffff                  1 10775.769</span></span>
<span><span class="co">#&gt;    3: 89a88cdb5b3ffff                  1 11480.254</span></span>
<span><span class="co">#&gt;    4: 89a88cdb5cfffff                  1 12689.441</span></span>
<span><span class="co">#&gt;    5: 89a88cd909bffff                  1 11361.664</span></span>
<span><span class="co">#&gt;   ---                                             </span></span>
<span><span class="co">#&gt; 1792: 89a881acda3ffff                  2  5621.512</span></span>
<span><span class="co">#&gt; 1793: 89a88cdb543ffff                  2  7406.822</span></span>
<span><span class="co">#&gt; 1794: 89a88cda667ffff                  2  5947.782</span></span>
<span><span class="co">#&gt; 1795: 89a88cd900fffff                  2  4565.564</span></span>
<span><span class="co">#&gt; 1796: 89a881aebafffff                  2     0.000</span></span></code></pre></div>
<p>When we create our own custom decay function, we don’t have to think
about general cases, just the cases that matter for us. Creating a
simple function that converts one vector into another, therefore, might
be enough, given our needs. If, however, you’re testing a new decay
function and you want to check its sensitivity to different decay
parameters, for example, you might be better off developing a decay
function that can take many decay values as inputs and returns a list of
weight vectors as output.</p>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-bauer2016measuring" class="csl-entry">
Bauer, Jan, and David A. Groneberg. 2016. <span>“Measuring <span>Spatial
Accessibility</span> of <span>Health Care Providers</span> –
<span>Introduction</span> of a <span>Variable Distance Decay
Function</span> Within the <span>Floating Catchment Area</span>
(<span>FCA</span>) <span>Method</span>.”</span> Edited by Kebede Deribe.
<em>PLOS ONE</em> 11 (7): e0159148. <a href="https://doi.org/10.1371/journal.pone.0159148" class="external-link">https://doi.org/10.1371/journal.pone.0159148</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rafael H. M. Pereira, Daniel Herszenhut, Ipea - Institute for Applied Economic Research.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
